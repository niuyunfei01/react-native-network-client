<html>
<head>
    <title>Messaging Test</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="user-scalable=no"/>
</head>
<body>
<iframe id="test" style="position: fixed; width: 100%; height: 100%; top: 0; left: 0;"
        src=''></iframe>
<script>
  (function () {
    var doLoad = function (center, apiKey) {
      var testId = document.getElementById('test');
      testId.src = 'https://m.amap.com/picker/?center=' + center + '&key=' + apiKey;
      var iframe = testId.contentWindow;
      testId.onload = function () {
        iframe.postMessage('hello', 'https://m.amap.com/picker/');
      };
    }

    window.addEventListener("message", function (e) {
      postMessage(JSON.stringify(e.data))
    });
    
    document.addEventListener("message", function (e) {
      if (typeof(e.data) == 'string') {
        var d = JSON.parse(e.data)
        if (d.action == 'set_params' && d.center && d.key) {
          doLoad(d.center, d.key)
          return;
        }
      }
    }, false);
  }())
</script>
</body>

</html>